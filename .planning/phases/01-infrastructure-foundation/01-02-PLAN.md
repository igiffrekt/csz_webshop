---
phase: 01-infrastructure-foundation
plan: 02
type: execute
wave: 1
depends_on: ["01"]
files_modified:
  - docker/docker-compose.yml
autonomous: true

must_haves:
  truths:
    - "PostgreSQL container starts and accepts connections"
    - "Database csz_strapi exists and is accessible"
    - "Data persists across container restarts"
  artifacts:
    - path: "docker/docker-compose.yml"
      provides: "PostgreSQL container configuration"
      contains: "postgres:16-alpine"
  key_links:
    - from: "docker/docker-compose.yml"
      to: "postgres_data volume"
      via: "Docker volume mount"
      pattern: "postgres_data:/var/lib/postgresql/data"
---

<objective>
Set up PostgreSQL database via Docker Compose for local development

Purpose: Provide the database backend required by Strapi CMS. Using Docker ensures consistent development environment and avoids local PostgreSQL installation complexity.

Output: Running PostgreSQL 16 container accessible at localhost:5432 with persistent data volume.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/01-infrastructure-foundation/01-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create Docker Compose configuration</name>
  <files>docker/docker-compose.yml</files>
  <action>
Create docker/docker-compose.yml with PostgreSQL 16 configuration:

```yaml
version: '3.8'

services:
  postgres:
    image: postgres:16-alpine
    container_name: csz-postgres
    restart: unless-stopped
    environment:
      POSTGRES_USER: strapi
      POSTGRES_PASSWORD: strapi
      POSTGRES_DB: csz_strapi
    ports:
      - "5432:5432"
    volumes:
      - postgres_data:/var/lib/postgresql/data
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -U strapi -d csz_strapi"]
      interval: 10s
      timeout: 5s
      retries: 5

volumes:
  postgres_data:
```

Key configuration choices:
- postgres:16-alpine for smaller image size
- Named volume for data persistence
- Health check for container readiness
- Credentials match what Strapi will use (strapi/strapi)
  </action>
  <verify>Run `docker compose -f docker/docker-compose.yml config` to validate YAML syntax</verify>
  <done>docker-compose.yml exists with valid PostgreSQL configuration</done>
</task>

<task type="auto">
  <name>Task 2: Start PostgreSQL and verify connectivity</name>
  <files>docker/docker-compose.yml</files>
  <action>
Start the PostgreSQL container:
```bash
docker compose -f docker/docker-compose.yml up -d
```

Wait for health check to pass (container should be healthy within 30 seconds).

Verify database connectivity:
```bash
docker exec csz-postgres pg_isready -U strapi -d csz_strapi
```

Should return: "csz_strapi - accepting connections"

If Docker is not installed or not running, note this as a blocker but do not fail the plan. The docker-compose.yml file is the deliverable; running it requires Docker Desktop.
  </action>
  <verify>Run `docker ps --filter name=csz-postgres` to confirm container is running with status "healthy"</verify>
  <done>PostgreSQL container is running and healthy, accepting connections on port 5432</done>
</task>

<task type="auto">
  <name>Task 3: Add convenience scripts to root package.json</name>
  <files>package.json</files>
  <action>
Add database management scripts to root package.json:

```json
{
  "scripts": {
    "db:start": "docker compose -f docker/docker-compose.yml up -d",
    "db:stop": "docker compose -f docker/docker-compose.yml down",
    "db:logs": "docker compose -f docker/docker-compose.yml logs -f postgres",
    "db:reset": "docker compose -f docker/docker-compose.yml down -v && docker compose -f docker/docker-compose.yml up -d"
  }
}
```

These scripts provide convenient database management:
- db:start - Start PostgreSQL in background
- db:stop - Stop PostgreSQL (data preserved)
- db:logs - Stream PostgreSQL logs
- db:reset - Destroy and recreate (WARNING: deletes all data)
  </action>
  <verify>Run `pnpm db:start` then `pnpm db:stop` to verify scripts work</verify>
  <done>Database convenience scripts added to package.json and working</done>
</task>

</tasks>

<verification>
1. `docker compose -f docker/docker-compose.yml config` validates without errors
2. `docker ps --filter name=csz-postgres` shows running container
3. `docker exec csz-postgres pg_isready -U strapi -d csz_strapi` returns "accepting connections"
4. `pnpm db:start` and `pnpm db:stop` scripts work
5. Data persists: stop container, start again, data still there
</verification>

<success_criteria>
- PostgreSQL 16 running in Docker container
- Database csz_strapi exists with user strapi
- Data persists across container restarts via named volume
- Convenience scripts available in package.json
- Ready for Strapi to connect
</success_criteria>

<output>
After completion, create `.planning/phases/01-infrastructure-foundation/01-02-SUMMARY.md`
</output>
