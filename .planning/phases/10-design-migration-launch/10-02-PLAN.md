---
phase: 10-design-migration-launch
plan: 02
type: implement
wave: 1
depends_on: [10-01]
files_modified:
  - apps/web/src/components/layout/Header.tsx
  - apps/web/src/components/layout/TopBar.tsx
  - apps/web/src/components/layout/MegaMenu.tsx
  - apps/web/src/components/layout/SearchBar.tsx
autonomous: true

must_haves:
  truths:
    - "Header matches reference design"
    - "Mega-menu shows categories"
    - "Search bar functional"
  artifacts:
    - apps/web/src/components/layout/MegaMenu.tsx
    - apps/web/src/components/layout/TopBar.tsx
---

<objective>
Redesign header with top bar, mega-menu, and enhanced search.

Purpose: Match the reference design header with category navigation and search.

Output: Complete header redesign with all navigation elements.
</objective>

<tasks>

<task type="auto">
  <name>Task 1: Create TopBar component</name>
  <files>
    apps/web/src/components/layout/TopBar.tsx
  </files>
  <action>
Create top bar with contact info and utility links:

```tsx
import { Phone, MapPin, Truck } from 'lucide-react';
import { Link } from '@/i18n/navigation';

export function TopBar() {
  return (
    <div className="bg-secondary-900 text-white text-sm">
      <div className="container mx-auto px-4">
        <div className="flex items-center justify-between h-10">
          {/* Left side - Contact */}
          <div className="flex items-center gap-6">
            <a
              href="tel:+3612345678"
              className="flex items-center gap-2 hover:text-primary-400 transition-colors"
            >
              <Phone className="h-4 w-4" />
              <span>+36 1 234 5678</span>
            </a>
            <a
              href="mailto:info@csz-tuzvedelmi.hu"
              className="hidden md:flex items-center gap-2 hover:text-primary-400 transition-colors"
            >
              info@csz-tuzvedelmi.hu
            </a>
          </div>

          {/* Right side - Links */}
          <div className="flex items-center gap-6">
            <Link
              href="/fiok/rendelesek"
              className="hidden sm:flex items-center gap-2 hover:text-primary-400 transition-colors"
            >
              <Truck className="h-4 w-4" />
              <span>Rendelés követése</span>
            </Link>
            <Link
              href="/kapcsolat"
              className="hidden md:flex items-center gap-2 hover:text-primary-400 transition-colors"
            >
              <MapPin className="h-4 w-4" />
              <span>Üzlet</span>
            </Link>
            <span className="text-primary-400 font-medium">
              Ingyenes szállítás 50.000 Ft felett!
            </span>
          </div>
        </div>
      </div>
    </div>
  );
}
```
  </action>
  <verify>
    - Contact phone and email
    - Order tracking link
    - Free shipping message
  </verify>
  <done>TopBar created</done>
</task>

<task type="auto">
  <name>Task 2: Create MegaMenu component</name>
  <files>
    apps/web/src/components/layout/MegaMenu.tsx
  </files>
  <action>
Create mega-menu dropdown for categories:

```tsx
'use client';

import { useState } from 'react';
import { ChevronDown, Grid3X3 } from 'lucide-react';
import { Link } from '@/i18n/navigation';
import { cn } from '@/lib/utils';

// Categories structure (can be fetched from API)
const categories = [
  {
    name: 'Tűzoltó készülékek',
    slug: 'tuzolto-keszulekek',
    subcategories: [
      { name: 'Poroltó készülékek', slug: 'porolto' },
      { name: 'CO2 oltók', slug: 'co2-olto' },
      { name: 'Haboltó készülékek', slug: 'habolto' },
      { name: 'Vízköddel oltók', slug: 'vizkoddel-olto' },
    ],
  },
  {
    name: 'Tűzjelző rendszerek',
    slug: 'tuzjelzo-rendszerek',
    subcategories: [
      { name: 'Füstérzékelők', slug: 'fusterzekelok' },
      { name: 'Hőérzékelők', slug: 'hoerzekelok' },
      { name: 'Kézi jelzésadók', slug: 'kezi-jelzesadok' },
    ],
  },
  {
    name: 'Védőfelszerelések',
    slug: 'vedofelszerelesek',
    subcategories: [
      { name: 'Tűzálló szekrények', slug: 'tuzallo-szekrenyek' },
      { name: 'Menekülési eszközök', slug: 'menekulesi-eszkozok' },
    ],
  },
  {
    name: 'Kiegészítők',
    slug: 'kiegeszitok',
    subcategories: [
      { name: 'Tartók és állványok', slug: 'tartok' },
      { name: 'Jelzőtáblák', slug: 'jelzotablak' },
    ],
  },
];

export function MegaMenu() {
  const [isOpen, setIsOpen] = useState(false);

  return (
    <div
      className="relative"
      onMouseEnter={() => setIsOpen(true)}
      onMouseLeave={() => setIsOpen(false)}
    >
      {/* Trigger button */}
      <button
        className={cn(
          'flex items-center gap-2 px-4 py-2 rounded-md font-medium transition-colors',
          'bg-primary-500 text-white hover:bg-primary-600',
          isOpen && 'bg-primary-600'
        )}
      >
        <Grid3X3 className="h-5 w-5" />
        <span>Kategóriák</span>
        <ChevronDown
          className={cn(
            'h-4 w-4 transition-transform',
            isOpen && 'rotate-180'
          )}
        />
      </button>

      {/* Dropdown menu */}
      <div
        className={cn(
          'absolute left-0 top-full pt-2 z-50 transition-all duration-200',
          isOpen ? 'opacity-100 visible' : 'opacity-0 invisible'
        )}
      >
        <div className="bg-white rounded-lg shadow-lg border p-6 min-w-[600px]">
          <div className="grid grid-cols-4 gap-6">
            {categories.map((category) => (
              <div key={category.slug}>
                <Link
                  href={`/kategoriak/${category.slug}`}
                  className="font-semibold text-secondary-900 hover:text-primary-500 transition-colors"
                >
                  {category.name}
                </Link>
                <ul className="mt-2 space-y-1">
                  {category.subcategories.map((sub) => (
                    <li key={sub.slug}>
                      <Link
                        href={`/kategoriak/${sub.slug}`}
                        className="text-sm text-secondary-600 hover:text-primary-500 transition-colors"
                      >
                        {sub.name}
                      </Link>
                    </li>
                  ))}
                </ul>
              </div>
            ))}
          </div>

          {/* Bottom promo */}
          <div className="mt-6 pt-4 border-t flex items-center justify-between">
            <p className="text-sm text-secondary-600">
              Nem találja amit keres?
            </p>
            <Link
              href="/kategoriak"
              className="text-sm font-medium text-primary-500 hover:text-primary-600"
            >
              Összes kategória →
            </Link>
          </div>
        </div>
      </div>
    </div>
  );
}
```
  </action>
  <verify>
    - Hover to open
    - Shows all categories
    - Subcategory links work
  </verify>
  <done>MegaMenu created</done>
</task>

<task type="auto">
  <name>Task 3: Create SearchBar component</name>
  <files>
    apps/web/src/components/layout/SearchBar.tsx
  </files>
  <action>
Create enhanced search bar for header:

```tsx
'use client';

import { useState, useRef, useEffect } from 'react';
import { Search, X, Loader2 } from 'lucide-react';
import { useRouter } from '@/i18n/navigation';
import { cn } from '@/lib/utils';

export function SearchBar() {
  const [query, setQuery] = useState('');
  const [isFocused, setIsFocused] = useState(false);
  const [isSearching, setIsSearching] = useState(false);
  const inputRef = useRef<HTMLInputElement>(null);
  const router = useRouter();

  const handleSubmit = (e: React.FormEvent) => {
    e.preventDefault();
    if (query.trim()) {
      setIsSearching(true);
      router.push(`/termekek?search=${encodeURIComponent(query.trim())}`);
      setIsSearching(false);
      setQuery('');
      inputRef.current?.blur();
    }
  };

  const handleClear = () => {
    setQuery('');
    inputRef.current?.focus();
  };

  return (
    <form onSubmit={handleSubmit} className="relative flex-1 max-w-xl">
      <div
        className={cn(
          'flex items-center bg-secondary-100 rounded-full overflow-hidden transition-all',
          isFocused && 'ring-2 ring-primary-500 bg-white'
        )}
      >
        <input
          ref={inputRef}
          type="text"
          value={query}
          onChange={(e) => setQuery(e.target.value)}
          onFocus={() => setIsFocused(true)}
          onBlur={() => setIsFocused(false)}
          placeholder="Keresés termékek között..."
          className="flex-1 bg-transparent px-4 py-2.5 outline-none text-sm placeholder:text-secondary-500"
        />

        {query && (
          <button
            type="button"
            onClick={handleClear}
            className="p-2 hover:text-primary-500 transition-colors"
          >
            <X className="h-4 w-4" />
          </button>
        )}

        <button
          type="submit"
          disabled={isSearching || !query.trim()}
          className={cn(
            'bg-primary-500 text-white p-2.5 hover:bg-primary-600 transition-colors',
            'disabled:opacity-50 disabled:cursor-not-allowed'
          )}
        >
          {isSearching ? (
            <Loader2 className="h-5 w-5 animate-spin" />
          ) : (
            <Search className="h-5 w-5" />
          )}
        </button>
      </div>
    </form>
  );
}
```
  </action>
  <verify>
    - Input with rounded style
    - Clear button when text entered
    - Submit navigates to products with search
  </verify>
  <done>SearchBar created</done>
</task>

<task type="auto">
  <name>Task 4: Redesign Header component</name>
  <files>
    apps/web/src/components/layout/Header.tsx
  </files>
  <action>
Completely redesign Header to match reference:

```tsx
import { Suspense } from 'react';
import { ShoppingCart, User, Heart } from 'lucide-react';
import { Link } from '@/i18n/navigation';
import { TopBar } from './TopBar';
import { MegaMenu } from './MegaMenu';
import { SearchBar } from './SearchBar';
import { HeaderCart } from '@/components/cart/HeaderCart';
import { UserMenu } from '@/components/auth/UserMenu';
import { MobileNav } from './MobileNav';

export async function Header() {
  return (
    <header className="sticky top-0 z-50 bg-white shadow-sm">
      {/* Top bar */}
      <TopBar />

      {/* Main header */}
      <div className="border-b">
        <div className="container mx-auto px-4">
          <div className="flex items-center justify-between h-16 gap-8">
            {/* Logo */}
            <Link href="/" className="flex-shrink-0">
              <span className="text-2xl font-bold text-secondary-900">
                CSZ <span className="text-primary-500">Tűzvédelem</span>
              </span>
            </Link>

            {/* Search - desktop */}
            <div className="hidden lg:flex flex-1 justify-center">
              <SearchBar />
            </div>

            {/* Actions */}
            <div className="flex items-center gap-4">
              {/* Wishlist - optional */}
              <Link
                href="/kedvencek"
                className="hidden md:flex items-center justify-center w-10 h-10 rounded-full hover:bg-secondary-100 transition-colors"
              >
                <Heart className="h-5 w-5 text-secondary-600" />
              </Link>

              {/* User menu */}
              <Suspense fallback={
                <div className="w-10 h-10 rounded-full bg-secondary-100 animate-pulse" />
              }>
                <UserMenu />
              </Suspense>

              {/* Cart */}
              <Suspense fallback={
                <div className="w-10 h-10 rounded-full bg-secondary-100 animate-pulse" />
              }>
                <HeaderCart />
              </Suspense>

              {/* Mobile menu */}
              <div className="lg:hidden">
                <MobileNav />
              </div>
            </div>
          </div>
        </div>
      </div>

      {/* Navigation bar - desktop */}
      <nav className="hidden lg:block border-b bg-white">
        <div className="container mx-auto px-4">
          <div className="flex items-center gap-8 h-12">
            {/* Mega menu */}
            <MegaMenu />

            {/* Main nav links */}
            <div className="flex items-center gap-6">
              <Link
                href="/termekek"
                className="text-sm font-medium text-secondary-700 hover:text-primary-500 transition-colors"
              >
                Összes termék
              </Link>
              <Link
                href="/termekek?featured=true"
                className="text-sm font-medium text-secondary-700 hover:text-primary-500 transition-colors"
              >
                Kiemelt
              </Link>
              <Link
                href="/termekek?onSale=true"
                className="text-sm font-medium text-secondary-700 hover:text-primary-500 transition-colors"
              >
                Akciók
              </Link>
              <Link
                href="/ajanlatkeres"
                className="text-sm font-medium text-secondary-700 hover:text-primary-500 transition-colors"
              >
                Árajánlat
              </Link>
              <Link
                href="/kapcsolat"
                className="text-sm font-medium text-secondary-700 hover:text-primary-500 transition-colors"
              >
                Kapcsolat
              </Link>
            </div>
          </div>
        </div>
      </nav>

      {/* Search - mobile */}
      <div className="lg:hidden border-b p-2">
        <SearchBar />
      </div>
    </header>
  );
}
```
  </action>
  <verify>
    - TopBar with contact info
    - Logo centered or left
    - Search bar prominent
    - Mega menu trigger
    - User and cart icons
    - Mobile responsive
  </verify>
  <done>Header redesigned</done>
</task>

<task type="auto">
  <name>Task 5: Update MobileNav for new design</name>
  <files>
    apps/web/src/components/layout/MobileNav.tsx
  </files>
  <action>
Update MobileNav to include categories and match new design style. Keep existing Sheet-based approach but update content to include category navigation.
  </action>
  <verify>
    - Categories in mobile menu
    - All nav links present
    - Proper styling
  </verify>
  <done>MobileNav updated</done>
</task>

<task type="auto">
  <name>Task 6: Verify header build</name>
  <files>
    -
  </files>
  <action>
Run build to verify all header components work:

```bash
pnpm --filter @csz/web build
```
  </action>
  <verify>
    - Build succeeds
    - No TypeScript errors
  </verify>
  <done>Header build verified</done>
</task>

</tasks>

<verification>
- TopBar shows contact info
- MegaMenu opens on hover
- SearchBar submits to products page
- Header responsive (mobile/desktop)
- All navigation links work
</verification>

<success_criteria>
- Header matches reference design layout
- Categories accessible via mega-menu
- Search functional
- Mobile responsive
</success_criteria>
