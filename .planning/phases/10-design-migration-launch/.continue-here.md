---
phase: 10-design-migration-launch
task: deployment-live
total_tasks: ongoing
status: in_progress
last_updated: 2026-02-11T21:10:34.778Z
---

<current_state>
Site is LIVE at https://igifftest.cc. Core functionality working: products, categories, auth (login/register with client-side redirect), cart. Sanity Studio deployment in progress — user ran `npx sanity deploy` from apps/studio, waiting to confirm hostname and access.
</current_state>

<completed_work>

## Deployment (2026-02-11)
- Fixed Stripe return URL bug (NEXT_PUBLIC_APP_URL -> NEXT_PUBLIC_SITE_URL)
- Added `output: 'standalone'` to Next.js config
- Updated .env.example and .env.production.example for current architecture
- Deleted stale files (docker-compose.prod.yml, root .env.example, old migration scripts)
- Created deploy.sh script (later removed PM2 since server has its own Node.js)
- Deployed to igifftest.cc (bare-metal Linux, OpenLiteSpeed hosting panel)
- Resolved multiple deployment issues:
  - MariaDB socket-only connection (?socket=/run/mysqld/mysqld.sock)
  - Password URL encoding (% -> %25)
  - Prisma generate before build
  - TypeScript error in sanity-order-sync.ts (cast through unknown)
  - NextAuth trustHost: true for reverse proxy
  - App must listen on 0.0.0.0 for hosting panel proxy
  - Created start.sh with env var exports for standalone server

## Bug Fixes (2026-02-11)
- Removed dead links from Footer (csapat, blog, karrier, partnerek, szallitas)
- Removed wishlist link from Header (/kedvencek)
- Removed BlogSection from homepage (links to non-existent /blog routes)
- Wrapped registerAction Prisma calls in try/catch with error logging
- Generated PWA icons (icon-192.png, icon-512.png, favicon.ico) from logo
- Fixed DialogContent/SheetContent missing Description warnings (AddressesClient, CartSheet, MobileNav)
- Fixed login/register redirect: switched from server-side redirect() to client-side router.push + router.refresh (useActionState doesn't reliably handle server-side redirects)
- Deleted duplicate middleware.ts (apps/web/middleware.ts) — src/middleware.ts is the correct one
- Ran Prisma migrations on production server (tables didn't exist)

</completed_work>

<remaining_work>

## Immediate
- Sanity Studio deployment — user was running `npx sanity deploy`, need to confirm completion
- Verify Sanity Studio accessible at chosen hostname

## Production Readiness
- Stripe webhook setup: register https://igifftest.cc/api/checkout/webhook in Stripe Dashboard
- Stripe live keys configuration in start.sh on server
- Test full checkout flow end-to-end
- Test order history after purchase
- Test quote request flow

## Nice-to-Have
- Add blog pages when content is ready (BlogSection component exists)
- Add wishlist page (/kedvencek) when feature is implemented
- Add shipping info page (/szallitas)

</remaining_work>

<decisions_made>

- Client-side redirect after login/register: server-side redirect() in useActionState doesn't reliably trigger navigation. Return { success: true } from action, useEffect + router.push in form component.
- Deleted duplicate middleware.ts at project root: src/middleware.ts is the correct location for projects using src/ directory.
- start.sh with hardcoded env exports: standalone Next.js server doesn't read .env files at runtime.
- HOSTNAME=0.0.0.0: hosting panel proxy requires app to listen on all interfaces.
- Sanity hosted studio (sanity deploy): easier than self-hosting, free tier.
- Removed unused Footer/Header links rather than creating stub pages.

</decisions_made>

<blockers>
- None currently blocking. All deployment issues resolved.
</blockers>

<context>
The site is live and functional at igifftest.cc. The main deployment hurdles (DB connection, auth, redirect, 404 errors) are all resolved. The user was in the middle of deploying Sanity Studio via `npx sanity deploy` when they paused.

Server details:
- Host: igifftest.cc (dedicated Linux, OpenLiteSpeed hosting panel)
- User: igifftes1
- Working dir: ~/public_html
- DB: igifftes1_csz (MariaDB via socket)
- DB user: igifftes1_csz / Gaestq7%+753
- Startup: bash start.sh (exports env vars + runs standalone server)
- Branch: csz-webshop-sanity

Key files on server (not in git):
- ~/public_html/start.sh — exports DATABASE_URL, NEXTAUTH_SECRET, NEXTAUTH_URL, HOSTNAME, PORT
</context>

<next_action>
Start with: Confirm Sanity Studio deployment completed. Ask user for the studio URL (e.g., csz-tuzvedelem.sanity.studio). Then move to Stripe webhook setup and end-to-end checkout testing.
</next_action>

<environment>
- Branch: csz-webshop-sanity
- Live site: https://igifftest.cc
- Server: igifftes1@igifftest.cc:~/public_html
- Sanity Studio: deploying via `npx sanity deploy`
- Working tree: CLEAN (all changes committed and pushed)
</environment>
