---
phase: 10-design-migration-launch
plan: 05
type: implement
wave: 2
depends_on: [10-01]
files_modified:
  - apps/web/src/components/home/ProductCollections.tsx
  - apps/web/src/components/product/ProductCardEnhanced.tsx
autonomous: true

must_haves:
  truths:
    - "Tabbed product collections"
    - "Enhanced product cards"
  artifacts:
    - apps/web/src/components/home/ProductCollections.tsx
    - apps/web/src/components/product/ProductCardEnhanced.tsx
---

<objective>
Create product collections section with tabs and enhanced product cards.

Purpose: Match reference design's tabbed product display.

Output: Product collections with All/Latest/Best Sellers/Featured tabs.
</objective>

<tasks>

<task type="auto">
  <name>Task 1: Create ProductCardEnhanced component</name>
  <files>
    apps/web/src/components/product/ProductCardEnhanced.tsx
  </files>
  <action>
Create enhanced product card with ratings, badges, and hover effects:

```tsx
'use client';

import Image from 'next/image';
import { Link } from '@/i18n/navigation';
import { Star, Heart, ShoppingCart, Eye } from 'lucide-react';
import { cn, formatPrice } from '@/lib/utils';
import { useCartStore } from '@/store/cart';
import type { Product } from '@csz/types';
import { toast } from 'sonner';

interface ProductCardEnhancedProps {
  product: Product;
  showRating?: boolean;
  showQuickActions?: boolean;
}

export function ProductCardEnhanced({
  product,
  showRating = true,
  showQuickActions = true,
}: ProductCardEnhancedProps) {
  const addItem = useCartStore((state) => state.addItem);
  const imageUrl = product.images?.[0]?.url
    ? `${process.env.NEXT_PUBLIC_STRAPI_URL || ''}${product.images[0].url}`
    : null;

  const isOnSale = product.compareAtPrice && product.compareAtPrice > product.basePrice;
  const discountPercent = isOnSale
    ? Math.round((1 - product.basePrice / product.compareAtPrice!) * 100)
    : 0;

  const handleAddToCart = (e: React.MouseEvent) => {
    e.preventDefault();
    e.stopPropagation();

    addItem({
      productId: product.documentId,
      variantId: null,
      name: product.name,
      price: product.basePrice,
      quantity: 1,
      image: imageUrl || undefined,
      sku: product.sku,
    });

    toast.success('Term√©k hozz√°adva a kos√°rhoz');
  };

  return (
    <div className="group relative bg-white rounded-xl border overflow-hidden card-lift">
      {/* Image container */}
      <Link href={`/termekek/${product.slug}`} className="block relative aspect-square overflow-hidden">
        {imageUrl ? (
          <Image
            src={imageUrl}
            alt={product.name}
            fill
            className="object-cover transition-transform duration-500 group-hover:scale-105"
            sizes="(max-width: 640px) 50vw, (max-width: 1024px) 33vw, 25vw"
          />
        ) : (
          <div className="w-full h-full bg-secondary-100 flex items-center justify-center">
            <span className="text-4xl">üßØ</span>
          </div>
        )}

        {/* Badges */}
        <div className="absolute top-3 left-3 flex flex-col gap-2">
          {isOnSale && (
            <span className="badge-discount">
              -{discountPercent}%
            </span>
          )}
          {product.isFeatured && (
            <span className="badge-new">
              Kiemelt
            </span>
          )}
          {product.stock === 0 && (
            <span className="bg-secondary-600 text-white text-xs font-medium px-2 py-1 rounded">
              Elfogyott
            </span>
          )}
        </div>

        {/* Quick actions */}
        {showQuickActions && (
          <div className="absolute top-3 right-3 flex flex-col gap-2 opacity-0 group-hover:opacity-100 transition-opacity">
            <button
              className="w-9 h-9 bg-white rounded-full shadow-md flex items-center justify-center hover:bg-primary-500 hover:text-white transition-colors"
              onClick={(e) => e.preventDefault()}
              title="Kedvencekhez"
            >
              <Heart className="h-4 w-4" />
            </button>
            <Link
              href={`/termekek/${product.slug}`}
              className="w-9 h-9 bg-white rounded-full shadow-md flex items-center justify-center hover:bg-primary-500 hover:text-white transition-colors"
              title="Megtekint√©s"
            >
              <Eye className="h-4 w-4" />
            </Link>
          </div>
        )}
      </Link>

      {/* Content */}
      <div className="p-4">
        {/* Category */}
        {product.category && (
          <Link
            href={`/kategoriak/${product.category.slug}`}
            className="text-xs text-secondary-500 hover:text-primary-500 transition-colors"
          >
            {product.category.name}
          </Link>
        )}

        {/* Title */}
        <Link href={`/termekek/${product.slug}`}>
          <h3 className="font-semibold text-secondary-900 mt-1 line-clamp-2 group-hover:text-primary-500 transition-colors">
            {product.name}
          </h3>
        </Link>

        {/* Rating */}
        {showRating && (
          <div className="flex items-center gap-1 mt-2">
            <div className="flex">
              {[1, 2, 3, 4, 5].map((star) => (
                <Star
                  key={star}
                  className={cn(
                    'h-4 w-4',
                    star <= 4 ? 'text-primary-500 fill-primary-500' : 'text-secondary-300'
                  )}
                />
              ))}
            </div>
            <span className="text-xs text-secondary-500">(4.0)</span>
          </div>
        )}

        {/* Price and cart */}
        <div className="flex items-center justify-between mt-3">
          <div className="flex items-center gap-2">
            <span className="price text-lg">
              {formatPrice(product.basePrice)}
            </span>
            {isOnSale && (
              <span className="price-original text-sm">
                {formatPrice(product.compareAtPrice!)}
              </span>
            )}
          </div>

          <button
            onClick={handleAddToCart}
            disabled={product.stock === 0}
            className={cn(
              'w-10 h-10 rounded-full flex items-center justify-center transition-colors',
              product.stock === 0
                ? 'bg-secondary-100 text-secondary-400 cursor-not-allowed'
                : 'bg-primary-500 text-white hover:bg-primary-600'
            )}
            title={product.stock === 0 ? 'Elfogyott' : 'Kos√°rba'}
          >
            <ShoppingCart className="h-5 w-5" />
          </button>
        </div>
      </div>
    </div>
  );
}
```
  </action>
  <verify>
    - Image with hover zoom
    - Discount badge
    - Rating stars
    - Add to cart button
    - Quick action buttons on hover
  </verify>
  <done>ProductCardEnhanced created</done>
</task>

<task type="auto">
  <name>Task 2: Create ProductCollections component</name>
  <files>
    apps/web/src/components/home/ProductCollections.tsx
  </files>
  <action>
Create tabbed product collections:

```tsx
'use client';

import { useState } from 'react';
import { cn } from '@/lib/utils';
import { ProductCardEnhanced } from '@/components/product/ProductCardEnhanced';
import type { Product } from '@csz/types';

interface ProductCollectionsProps {
  products: Product[];
  featuredProducts: Product[];
}

const tabs = [
  { id: 'all', label: '√ñsszes term√©k' },
  { id: 'latest', label: 'Leg√∫jabb' },
  { id: 'bestsellers', label: 'Legn√©pszer≈±bb' },
  { id: 'featured', label: 'Kiemelt' },
];

export function ProductCollections({
  products,
  featuredProducts,
}: ProductCollectionsProps) {
  const [activeTab, setActiveTab] = useState('all');

  const getFilteredProducts = () => {
    switch (activeTab) {
      case 'featured':
        return featuredProducts.length > 0 ? featuredProducts : products.filter(p => p.isFeatured);
      case 'latest':
        // Sort by createdAt descending
        return [...products].sort((a, b) =>
          new Date(b.createdAt).getTime() - new Date(a.createdAt).getTime()
        );
      case 'bestsellers':
        // In a real app, this would be based on sales data
        // For now, show products with stock (implying they sell)
        return products.filter(p => p.stock && p.stock > 0);
      default:
        return products;
    }
  };

  const displayProducts = getFilteredProducts().slice(0, 8);

  return (
    <section className="section bg-secondary-50">
      <div className="container mx-auto px-4">
        {/* Section header */}
        <div className="section-header">
          <span className="text-primary-500 font-medium text-sm uppercase tracking-wide">
            Term√©keink
          </span>
          <h2 className="section-title">Term√©kk√≠n√°latunk</h2>
        </div>

        {/* Tabs */}
        <div className="flex flex-wrap justify-center gap-2 mb-8">
          {tabs.map((tab) => (
            <button
              key={tab.id}
              onClick={() => setActiveTab(tab.id)}
              className={cn(
                'px-6 py-2 rounded-full text-sm font-medium transition-colors',
                activeTab === tab.id
                  ? 'bg-primary-500 text-white'
                  : 'bg-white text-secondary-700 hover:bg-secondary-100'
              )}
            >
              {tab.label}
            </button>
          ))}
        </div>

        {/* Product grid */}
        <div className="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4 md:gap-6">
          {displayProducts.map((product) => (
            <ProductCardEnhanced
              key={product.documentId}
              product={product}
            />
          ))}
        </div>

        {/* View all button */}
        <div className="text-center mt-8">
          <a
            href="/termekek"
            className="inline-flex items-center justify-center px-8 py-3 bg-secondary-900 text-white font-medium rounded-full hover:bg-secondary-800 transition-colors"
          >
            √ñsszes term√©k megtekint√©se
          </a>
        </div>
      </div>
    </section>
  );
}
```
  </action>
  <verify>
    - Tab navigation works
    - Products filter by tab
    - Grid layout responsive
  </verify>
  <done>ProductCollections created</done>
</task>

<task type="auto">
  <name>Task 3: Export components</name>
  <files>
    apps/web/src/components/home/index.ts
    apps/web/src/components/product/index.ts
  </files>
  <action>
Update exports for new components.
  </action>
  <verify>
    - Exports added
  </verify>
  <done>Exports updated</done>
</task>

</tasks>

<verification>
- ProductCardEnhanced shows all design elements
- ProductCollections tabs work
- Products display in grid
</verification>

<success_criteria>
- Product cards match reference design
- Tab filtering works correctly
</success_criteria>
