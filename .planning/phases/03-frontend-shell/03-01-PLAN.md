---
phase: 03-frontend-shell
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - apps/web/package.json
  - apps/web/tsconfig.json
  - apps/web/next.config.ts
  - apps/web/src/app/globals.css
  - apps/web/src/app/layout.tsx
  - apps/web/src/app/page.tsx
  - apps/web/src/lib/api.ts
  - apps/web/src/lib/formatters.ts
  - apps/web/src/i18n/routing.ts
  - apps/web/src/i18n/request.ts
  - apps/web/src/messages/hu.json
  - apps/web/middleware.ts
  - apps/web/components.json
  - packages/types/src/index.ts
autonomous: true

must_haves:
  truths:
    - "Next.js dev server starts without errors"
    - "Tailwind CSS classes apply correctly"
    - "API client can fetch from Strapi"
    - "HUF currency formatting works correctly"
    - "Hungarian locale is default"
  artifacts:
    - path: "apps/web/package.json"
      provides: "Next.js app with all dependencies"
      contains: "next"
    - path: "apps/web/src/lib/api.ts"
      provides: "API client for Strapi"
      exports: ["getProducts", "getProduct", "getCategories"]
    - path: "apps/web/src/lib/formatters.ts"
      provides: "HUF price formatting"
      exports: ["formatPrice"]
    - path: "packages/types/src/index.ts"
      provides: "Shared TypeScript types for Product, Category, Variant"
      exports: ["Product", "Category", "ProductVariant"]
  key_links:
    - from: "apps/web/src/lib/api.ts"
      to: "Strapi API"
      via: "fetch with qs query builder"
      pattern: "fetch.*api/products"
    - from: "apps/web/src/lib/formatters.ts"
      to: "Intl.NumberFormat"
      via: "hu-HU locale, HUF currency"
      pattern: "NumberFormat.*hu-HU"
---

<objective>
Initialize the Next.js 16 frontend application with Tailwind CSS v4, shadcn/ui, next-intl for Hungarian localization, and the API client for fetching product data from Strapi.

Purpose: Establish the frontend foundation that all other Phase 3 plans will build upon - routing, styling, data fetching, and type safety.

Output: A working Next.js app at apps/web with dev server running, ready for page development.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03-frontend-shell/03-RESEARCH.md
@apps/cms/src/api/product/content-types/product/schema.json
@apps/cms/src/api/category/content-types/category/schema.json
@apps/cms/src/api/product-variant/content-types/product-variant/schema.json
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create Next.js 16 app with dependencies</name>
  <files>
    apps/web/package.json
    apps/web/tsconfig.json
    apps/web/next.config.ts
    apps/web/src/app/globals.css
    apps/web/src/app/layout.tsx
    apps/web/src/app/page.tsx
    apps/web/middleware.ts
  </files>
  <action>
Create the Next.js 16 application in apps/web using create-next-app with the following options:
- TypeScript enabled
- Tailwind CSS v4 enabled
- App Router (not Pages Router)
- src/ directory enabled
- Import alias @/*

After scaffolding, install additional dependencies:
```bash
pnpm add nuqs @tanstack/react-query motion next-intl qs
pnpm add -D @types/qs
```

Configure next.config.ts:
- Add images.remotePatterns for Strapi uploads (localhost:1337 for dev)
- Configure experimental.ppr if needed

Configure Tailwind CSS v4 in globals.css:
- Use @import 'tailwindcss' syntax (not @tailwind directives)
- Add CSS variables for design tokens in @theme block
- Set up Inter font as default sans

Create root layout.tsx:
- Import globals.css
- Set html lang="hu"
- Basic metadata with Hungarian title

Create temporary page.tsx:
- Simple "CSZ Webshop" heading to verify setup works

Create middleware.ts:
- Configure next-intl middleware with 'hu' as default/only locale
- Exclude api routes and static assets from locale prefix
  </action>
  <verify>
Run `pnpm dev:web` and verify:
- Dev server starts on http://localhost:3000
- Page renders with "CSZ Webshop" heading
- No TypeScript or build errors in terminal
  </verify>
  <done>Next.js app scaffolded with Tailwind CSS v4, dev server runs without errors</done>
</task>

<task type="auto">
  <name>Task 2: Add shadcn/ui and shared TypeScript types</name>
  <files>
    apps/web/components.json
    apps/web/src/components/ui/button.tsx
    packages/types/src/index.ts
  </files>
  <action>
Initialize shadcn/ui in apps/web:
```bash
cd apps/web && pnpm dlx shadcn@latest init
```
Select options:
- Style: New York
- Base color: Neutral
- CSS variables: yes

Add Button component as initial test:
```bash
pnpm dlx shadcn@latest add button
```

Update packages/types/src/index.ts with TypeScript types matching Strapi schema:

```typescript
// Media type from Strapi
export interface StrapiMedia {
  id: number;
  documentId: string;
  url: string;
  alternativeText: string | null;
  name: string;
  width?: number;
  height?: number;
  formats?: {
    thumbnail?: { url: string; width: number; height: number };
    small?: { url: string; width: number; height: number };
    medium?: { url: string; width: number; height: number };
    large?: { url: string; width: number; height: number };
  };
}

// Specification component
export interface Specification {
  id: number;
  name: string;
  value: string;
  unit?: string;
}

// Certification component
export interface Certification {
  id: number;
  name: string;
  standard?: string;
  issuedDate?: string;
  expiryDate?: string;
  certificate?: StrapiMedia;
}

// Category
export interface Category {
  id: number;
  documentId: string;
  name: string;
  slug: string;
  description?: string;
  image?: StrapiMedia;
  parent?: Category;
  children?: Category[];
  products?: Product[];
  createdAt: string;
  updatedAt: string;
  publishedAt: string;
}

// Product Variant
export interface ProductVariant {
  id: number;
  documentId: string;
  name: string;
  sku: string;
  price: number;
  compareAtPrice?: number;
  stock: number;
  weight?: number;
  attributeLabel?: string;
  attributeValue?: string;
  image?: StrapiMedia;
  createdAt: string;
  updatedAt: string;
  publishedAt: string;
}

// Product
export interface Product {
  id: number;
  documentId: string;
  name: string;
  slug: string;
  sku: string;
  description?: string;
  shortDescription?: string;
  basePrice: number;
  compareAtPrice?: number;
  stock: number;
  weight?: number;
  isFeatured: boolean;
  isOnSale: boolean;
  images?: StrapiMedia[];
  documents?: StrapiMedia[];
  specifications?: Specification[];
  certifications?: Certification[];
  categories?: Category[];
  variants?: ProductVariant[];
  createdAt: string;
  updatedAt: string;
  publishedAt: string;
}

// Strapi response wrappers
export interface StrapiResponse<T> {
  data: T;
  meta: {
    pagination?: {
      page: number;
      pageSize: number;
      pageCount: number;
      total: number;
    };
  };
}

export interface StrapiListResponse<T> {
  data: T[];
  meta: {
    pagination: {
      page: number;
      pageSize: number;
      pageCount: number;
      total: number;
    };
  };
}
```
  </action>
  <verify>
Run `pnpm build` from root to verify types package compiles.
Import Button in page.tsx and render it to verify shadcn/ui works.
  </verify>
  <done>shadcn/ui initialized with Button component, shared types package has Product, Category, ProductVariant types</done>
</task>

<task type="auto">
  <name>Task 3: Create API client and formatters</name>
  <files>
    apps/web/src/lib/api.ts
    apps/web/src/lib/formatters.ts
    apps/web/src/i18n/routing.ts
    apps/web/src/i18n/request.ts
    apps/web/src/messages/hu.json
    apps/web/src/components/providers/QueryProvider.tsx
    apps/web/src/app/[locale]/layout.tsx
    apps/web/src/app/[locale]/page.tsx
  </files>
  <action>
Create apps/web/src/lib/api.ts with functions to fetch from Strapi:
- Use qs library for building populate queries
- Base URL from NEXT_PUBLIC_STRAPI_URL env var (default http://localhost:1337)
- getProducts(filters) - list with pagination, category filter, search, featured filter
- getProduct(slug) - single product with all relations populated
- getCategories() - list of categories with hierarchy
- getFeaturedProducts() - shortcut for featured=true products

Example getProducts implementation:
```typescript
import qs from 'qs';
import type { Product, StrapiListResponse } from '@csz/types';

const STRAPI_URL = process.env.NEXT_PUBLIC_STRAPI_URL || 'http://localhost:1337';

export interface ProductFilters {
  category?: string;
  search?: string;
  featured?: boolean;
  onSale?: boolean;
  page?: number;
  pageSize?: number;
}

export async function getProducts(filters: ProductFilters = {}): Promise<StrapiListResponse<Product>> {
  const query = qs.stringify({
    filters: {
      ...(filters.category && { categories: { slug: { $eq: filters.category } } }),
      ...(filters.search && { name: { $containsi: filters.search } }),
      ...(filters.featured && { isFeatured: { $eq: true } }),
      ...(filters.onSale && { isOnSale: { $eq: true } }),
    },
    populate: {
      images: { fields: ['url', 'alternativeText', 'width', 'height', 'formats'] },
      categories: { fields: ['name', 'slug'] },
      certifications: true,
    },
    pagination: {
      page: filters.page || 1,
      pageSize: filters.pageSize || 12,
    },
    sort: ['createdAt:desc'],
  }, { encodeValuesOnly: true });

  const res = await fetch(`${STRAPI_URL}/api/products?${query}`, {
    next: { revalidate: 60 }, // ISR: revalidate every 60 seconds
  });

  if (!res.ok) {
    throw new Error(`Failed to fetch products: ${res.status}`);
  }

  return res.json();
}
```

Create apps/web/src/lib/formatters.ts:
```typescript
const hufFormatter = new Intl.NumberFormat('hu-HU', {
  style: 'currency',
  currency: 'HUF',
  maximumFractionDigits: 0,
});

export function formatPrice(amount: number): string {
  return hufFormatter.format(amount);
}

export function getStrapiMediaUrl(url: string | undefined): string {
  if (!url) return '/placeholder.jpg';
  if (url.startsWith('http')) return url;
  const baseUrl = process.env.NEXT_PUBLIC_STRAPI_URL || 'http://localhost:1337';
  return `${baseUrl}${url}`;
}
```

Set up next-intl:
1. Create apps/web/src/i18n/routing.ts with locales: ['hu'], defaultLocale: 'hu'
2. Create apps/web/src/i18n/request.ts with getRequestConfig
3. Create apps/web/src/messages/hu.json with initial UI strings:
   - common.siteName: "CSZ Webshop"
   - common.loading: "Betöltés..."
   - products.title: "Termékek"
   - products.search: "Keresés..."
   - products.filter: "Szűrés"
   - products.noResults: "Nincs találat"
   - products.addToCart: "Kosárba"

Create apps/web/src/components/providers/QueryProvider.tsx (Client Component):
```typescript
'use client';

import { QueryClient, QueryClientProvider } from '@tanstack/react-query';
import { useState } from 'react';

export function QueryProvider({ children }: { children: React.ReactNode }) {
  const [queryClient] = useState(() => new QueryClient({
    defaultOptions: {
      queries: {
        staleTime: 60 * 1000,
        refetchOnWindowFocus: false,
      },
    },
  }));

  return (
    <QueryClientProvider client={queryClient}>
      {children}
    </QueryClientProvider>
  );
}
```

Move page content to [locale] route segment:
1. Create apps/web/src/app/[locale]/layout.tsx - wrap with NextIntlClientProvider and QueryProvider
2. Move page.tsx to apps/web/src/app/[locale]/page.tsx
3. Update root layout.tsx to be minimal (just html/body)

Add .env.local to apps/web (and .env.example):
```
NEXT_PUBLIC_STRAPI_URL=http://localhost:1337
```
  </action>
  <verify>
1. Run `pnpm dev:web` and verify no errors
2. Temporarily add console.log(formatPrice(15900)) in page.tsx - should output "15 900 Ft"
3. Add a test fetch in page.tsx:
   ```typescript
   const products = await getProducts({ featured: true });
   console.log('Products:', products);
   ```
   (Requires Strapi running with db:start first)
  </verify>
  <done>API client fetches from Strapi, formatPrice outputs "15 900 Ft", next-intl configured for Hungarian</done>
</task>

</tasks>

<verification>
After all tasks complete:
1. `pnpm dev:web` starts Next.js dev server on port 3000
2. Page renders with Hungarian locale (html lang="hu")
3. Tailwind CSS classes work (test with utility classes)
4. shadcn/ui Button component renders correctly
5. API client can fetch products from Strapi (when CMS is running)
6. formatPrice(15900) returns "15 900 Ft"
7. TypeScript compilation passes with no errors
</verification>

<success_criteria>
- Next.js 16 app running with Tailwind CSS v4 and App Router
- shadcn/ui initialized with Button component
- Shared types package has Product, Category, ProductVariant interfaces
- API client can fetch from Strapi with proper populate queries
- HUF currency formatting works correctly
- Hungarian locale configured as default
- No TypeScript errors
</success_criteria>

<output>
After completion, create `.planning/phases/03-frontend-shell/03-01-SUMMARY.md`
</output>
