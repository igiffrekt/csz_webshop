---
phase: 03-frontend-shell
plan: 05
type: execute
wave: 4
depends_on: ["03-03", "03-04"]
files_modified:
  - apps/web/src/app/[locale]/kategoriak/page.tsx
  - apps/web/src/app/[locale]/kategoriak/[slug]/page.tsx
  - apps/web/src/components/category/CategoryCard.tsx
  - apps/web/src/components/category/CategoryHeader.tsx
  - apps/web/src/lib/api.ts
  - apps/web/src/messages/hu.json
autonomous: false

must_haves:
  truths:
    - "User can browse all categories on /kategoriak page"
    - "User can navigate to category detail and see products"
    - "Category pages show correct filtered products"
    - "UI is fully responsive and in Hungarian"
  artifacts:
    - path: "apps/web/src/app/[locale]/kategoriak/page.tsx"
      provides: "Category listing page"
      min_lines: 30
    - path: "apps/web/src/app/[locale]/kategoriak/[slug]/page.tsx"
      provides: "Category detail with product grid"
      min_lines: 40
    - path: "apps/web/src/components/category/CategoryCard.tsx"
      provides: "Category card component"
      min_lines: 20
  key_links:
    - from: "apps/web/src/app/[locale]/kategoriak/[slug]/page.tsx"
      to: "getProducts with category filter"
      via: "Server Component async fetch"
      pattern: "getProducts.*category"
---

<objective>
Build category listing and detail pages, then verify the entire frontend shell with user testing.

Purpose: Complete CONT-02 (category listing pages) and enable users to browse products by category hierarchy. Final verification ensures all Phase 3 requirements are met.

Output: Working category pages and user-verified frontend shell ready for Phase 4 (Shopping Cart).
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03-frontend-shell/03-RESEARCH.md
@.planning/phases/03-frontend-shell/03-03-SUMMARY.md
@.planning/phases/03-frontend-shell/03-04-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create category listing and detail pages</name>
  <files>
    apps/web/src/app/[locale]/kategoriak/page.tsx
    apps/web/src/app/[locale]/kategoriak/[slug]/page.tsx
    apps/web/src/app/[locale]/kategoriak/[slug]/not-found.tsx
    apps/web/src/components/category/CategoryCard.tsx
    apps/web/src/components/category/CategoryHeader.tsx
    apps/web/src/lib/api.ts
    apps/web/src/messages/hu.json
  </files>
  <action>
**Add getCategory to api.ts:**
```typescript
export async function getCategory(slug: string): Promise<Category | null> {
  const query = qs.stringify({
    filters: { slug: { $eq: slug } },
    populate: {
      image: { fields: ['url', 'alternativeText', 'width', 'height'] },
      children: {
        fields: ['name', 'slug'],
        populate: {
          image: { fields: ['url', 'alternativeText'] }
        }
      },
      parent: { fields: ['name', 'slug'] },
    }
  }, { encodeValuesOnly: true });

  const res = await fetch(`${STRAPI_URL}/api/categories?${query}`, {
    next: { revalidate: 60 },
  });

  if (!res.ok) {
    return null;
  }

  const data = await res.json();
  return data.data?.[0] ?? null;
}
```

**Create CategoryCard.tsx (Server Component):**
```typescript
import Image from 'next/image';
import Link from 'next/link';
import { getStrapiMediaUrl } from '@/lib/formatters';
import type { Category } from '@csz/types';

interface CategoryCardProps {
  category: Category;
}

export function CategoryCard({ category }: CategoryCardProps) {
  return (
    <Link
      href={`/kategoriak/${category.slug}`}
      className="group block"
    >
      <div className="relative aspect-[4/3] overflow-hidden rounded-lg bg-gray-100">
        {category.image ? (
          <Image
            src={getStrapiMediaUrl(category.image.url)}
            alt={category.image.alternativeText || category.name}
            fill
            sizes="(max-width: 640px) 100vw, (max-width: 1024px) 50vw, 33vw"
            className="object-cover transition-transform group-hover:scale-105"
          />
        ) : (
          <div className="flex items-center justify-center h-full bg-muted">
            <span className="text-muted-foreground">Nincs kép</span>
          </div>
        )}
      </div>
      <h3 className="mt-3 text-lg font-medium group-hover:text-primary transition-colors">
        {category.name}
      </h3>
      {category.description && (
        <p className="mt-1 text-sm text-muted-foreground line-clamp-2">
          {category.description}
        </p>
      )}
    </Link>
  );
}
```

**Create CategoryHeader.tsx (Server Component):**
```typescript
import Image from 'next/image';
import Link from 'next/link';
import { ChevronRight } from 'lucide-react';
import { getStrapiMediaUrl } from '@/lib/formatters';
import type { Category } from '@csz/types';

interface CategoryHeaderProps {
  category: Category;
}

export function CategoryHeader({ category }: CategoryHeaderProps) {
  return (
    <div className="mb-8">
      {/* Breadcrumb */}
      <nav className="text-sm text-muted-foreground mb-4 flex items-center gap-1">
        <Link href="/kategoriak" className="hover:underline">Kategóriák</Link>
        {category.parent && (
          <>
            <ChevronRight className="h-4 w-4" />
            <Link href={`/kategoriak/${category.parent.slug}`} className="hover:underline">
              {category.parent.name}
            </Link>
          </>
        )}
        <ChevronRight className="h-4 w-4" />
        <span>{category.name}</span>
      </nav>

      {/* Header with optional image */}
      <div className="flex items-start gap-6">
        {category.image && (
          <div className="relative h-24 w-24 flex-shrink-0 overflow-hidden rounded-lg">
            <Image
              src={getStrapiMediaUrl(category.image.url)}
              alt={category.name}
              fill
              className="object-cover"
            />
          </div>
        )}
        <div>
          <h1 className="text-3xl font-bold">{category.name}</h1>
          {category.description && (
            <p className="mt-2 text-muted-foreground">{category.description}</p>
          )}
        </div>
      </div>
    </div>
  );
}
```

**Create /kategoriak/page.tsx:**
```typescript
import { Metadata } from 'next';
import { getCategories } from '@/lib/api';
import { CategoryCard } from '@/components/category/CategoryCard';
import { getTranslations } from 'next-intl/server';

export async function generateMetadata(): Promise<Metadata> {
  const t = await getTranslations('categories');
  return {
    title: t('title'),
    description: 'Böngésszen tűzvédelmi eszköz kategóriáink között',
  };
}

export default async function CategoriesPage() {
  const t = await getTranslations('categories');
  const categoriesResponse = await getCategories();

  return (
    <main className="container mx-auto px-4 py-8">
      <h1 className="text-3xl font-bold mb-8">{t('title')}</h1>

      {categoriesResponse.data.length > 0 ? (
        <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6">
          {categoriesResponse.data.map((category) => (
            <CategoryCard key={category.documentId} category={category} />
          ))}
        </div>
      ) : (
        <p className="text-muted-foreground">{t('noCategories')}</p>
      )}
    </main>
  );
}
```

**Create /kategoriak/[slug]/page.tsx:**
```typescript
import { Metadata } from 'next';
import { notFound } from 'next/navigation';
import { getCategory, getProducts } from '@/lib/api';
import { CategoryHeader } from '@/components/category/CategoryHeader';
import { CategoryCard } from '@/components/category/CategoryCard';
import { ProductGrid } from '@/components/product/ProductGrid';
import { Pagination } from '@/components/product/Pagination';
import { EmptyState } from '@/components/product/EmptyState';

interface Props {
  params: Promise<{ slug: string; locale: string }>;
  searchParams: Promise<{ page?: string }>;
}

export async function generateMetadata({ params }: Props): Promise<Metadata> {
  const { slug } = await params;
  const category = await getCategory(slug);

  if (!category) {
    return { title: 'Kategória nem található' };
  }

  return {
    title: category.name,
    description: category.description || `${category.name} - Tűzvédelmi eszközök`,
  };
}

export default async function CategoryPage({ params, searchParams }: Props) {
  const { slug } = await params;
  const search = await searchParams;
  const category = await getCategory(slug);

  if (!category) {
    notFound();
  }

  // Fetch products in this category
  const productsResponse = await getProducts({
    category: slug,
    page: search.page ? parseInt(search.page, 10) : 1,
    pageSize: 12,
  });

  const { data: products, meta } = productsResponse;
  const { pagination } = meta;
  const hasSubcategories = category.children && category.children.length > 0;

  return (
    <main className="container mx-auto px-4 py-8">
      <CategoryHeader category={category} />

      {/* Subcategories */}
      {hasSubcategories && (
        <section className="mb-12">
          <h2 className="text-xl font-semibold mb-4">Alkategóriák</h2>
          <div className="grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-4 gap-4">
            {category.children!.map((child) => (
              <CategoryCard key={child.documentId} category={child} />
            ))}
          </div>
        </section>
      )}

      {/* Products */}
      <section>
        <h2 className="text-xl font-semibold mb-4">
          Termékek {pagination && `(${pagination.total})`}
        </h2>

        {products.length > 0 ? (
          <>
            <ProductGrid products={products} />
            {pagination && (
              <Pagination
                currentPage={pagination.page}
                totalPages={pagination.pageCount}
                totalItems={pagination.total}
              />
            )}
          </>
        ) : (
          <EmptyState />
        )}
      </section>
    </main>
  );
}
```

**Create /kategoriak/[slug]/not-found.tsx:**
```typescript
import Link from 'next/link';
import { Button } from '@/components/ui/button';

export default function CategoryNotFound() {
  return (
    <main className="container mx-auto px-4 py-16 text-center">
      <h1 className="text-2xl font-bold mb-4">Kategória nem található</h1>
      <p className="text-muted-foreground mb-8">
        A keresett kategória nem létezik vagy eltávolításra került.
      </p>
      <Link href="/kategoriak">
        <Button>Vissza a kategóriákhoz</Button>
      </Link>
    </main>
  );
}
```

**Update hu.json:**
```json
{
  "categories": {
    "title": "Kategóriák",
    "noCategories": "Jelenleg nincsenek kategóriák",
    "subcategories": "Alkategóriák",
    "products": "Termékek"
  }
}
```
  </action>
  <verify>
1. Navigate to /kategoriak - see all top-level categories
2. Click a category - navigate to /kategoriak/[slug]
3. Category page shows header, subcategories (if any), and products
4. Pagination works on category page
5. Invalid slug shows 404 page
6. Breadcrumb navigation works correctly
  </verify>
  <done>Category listing and detail pages render correctly with product filtering</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>
Complete frontend shell with:
- Next.js 16 app with Tailwind CSS v4 and shadcn/ui
- Home page with hero, featured products, category grid
- Product listing page with search, category filter, pagination
- Product detail page with gallery, specs, certifications, documents
- Category listing and detail pages
- Responsive layout with header, footer, mobile navigation
- All UI text in Hungarian, prices in HUF
  </what-built>
  <how-to-verify>
**Prerequisites:**
1. Start PostgreSQL: `pnpm db:start`
2. Start Strapi: `pnpm dev:cms`
3. In Strapi (http://localhost:1337/admin):
   - Create 2 categories (e.g., "Poroltók", "Tűzjelzők")
   - Create 3-4 products with:
     - Images uploaded
     - Assigned to categories
     - At least 1 marked as featured (isFeatured: true)
     - At least 1 with certifications added
     - At least 1 with specifications added
     - At least 1 with document uploaded
   - Publish all content
4. Start frontend: `pnpm dev:web`

**Test Flow:**
1. **Home page (http://localhost:3000/hu)**
   - [ ] Hero section visible with Hungarian headline
   - [ ] Featured products section shows featured product(s)
   - [ ] Category grid shows categories
   - [ ] Header has navigation links
   - [ ] Footer has links and Hungarian text

2. **Product listing (/termekek)**
   - [ ] Product grid displays all products
   - [ ] Search box works (type product name, see filtered results)
   - [ ] Category dropdown filters products
   - [ ] URL updates with filter params (?q=..., ?category=...)
   - [ ] Refresh page - filters persist

3. **Product detail (click a product)**
   - [ ] Image gallery with thumbnails
   - [ ] Product name, price in HUF format (e.g., "15 900 Ft")
   - [ ] Stock status shows
   - [ ] Certification badges visible (if added)
   - [ ] Specifications table visible (if added)
   - [ ] Document download link works (if added)

4. **Category pages (/kategoriak)**
   - [ ] Category listing shows all categories
   - [ ] Click category - shows products in that category
   - [ ] Breadcrumb navigation works

5. **Mobile responsiveness**
   - [ ] Open DevTools, set to mobile viewport (375px)
   - [ ] Header shows hamburger menu
   - [ ] Mobile nav opens and closes
   - [ ] Product grid adjusts to 1-2 columns
   - [ ] All content readable without horizontal scroll

6. **No console errors**
   - [ ] Open browser DevTools Console
   - [ ] No red errors during navigation
   - [ ] No hydration mismatch warnings
  </how-to-verify>
  <resume-signal>
Type "approved" if all checks pass.
If issues found, describe them and I will create fix tasks.
  </resume-signal>
</task>

</tasks>

<verification>
After all tasks complete and user approves:
1. All category pages functional
2. Full product browsing flow works end-to-end
3. All UI in Hungarian
4. All prices in HUF format
5. Mobile responsive
6. No console errors
</verification>

<success_criteria>
- Category listing page at /kategoriak shows all categories
- Category detail page at /kategoriak/[slug] shows filtered products
- Full user journey: Home -> Category -> Product works
- User verification passes all checks
- Phase 3 requirements PROD-01 through PROD-08, CONT-01 through CONT-03, LANG-01, LANG-04, PERF-03, PERF-04 satisfied
</success_criteria>

<output>
After completion, create `.planning/phases/03-frontend-shell/03-05-SUMMARY.md`
</output>
