---
phase: 04-shopping-cart
plan: 08
type: execute
wave: 5
depends_on: ["04-03", "04-07"]
files_modified: []
autonomous: false

must_haves:
  truths:
    - "All CART requirements (CART-01 through CART-07) are satisfied"
    - "All ADMN coupon requirements (ADMN-15 through ADMN-19) are satisfied"
    - "Add-to-cart animation (ANIM-05) provides visual feedback"
    - "Cart persists across browser sessions"
    - "Full shopping flow works end-to-end"
  artifacts: []
  key_links: []
---

<objective>
Verify complete Phase 4 implementation against all requirements.

Purpose: Ensure all shopping cart functionality works correctly before moving to Phase 5 (Authentication). This verification confirms all requirements are met and identifies any gaps.

Output: Verification report confirming all requirements pass or documenting issues to address.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/REQUIREMENTS.md
@.planning/phases/04-shopping-cart/04-RESEARCH.md
</context>

<tasks>

<task type="checkpoint:human-verify" gate="blocking">
  <name>Verify Cart Functionality (CART-01 through CART-06)</name>
  <what-built>
Complete shopping cart with:
- Zustand store with localStorage persistence
- Add to cart with variant selection
- Cart sheet with item list
- Quantity controls and item removal
- Cart persistence across sessions
  </what-built>
  <how-to-verify>
**Setup:**
1. Ensure all services running: `pnpm db:start && pnpm dev:cms && pnpm dev:api && pnpm dev:web`
2. Have at least one product with variants in Strapi (create test data if needed)

**CART-01: User can add products to cart**
1. Navigate to http://localhost:3000/hu/termekek
2. Click on any product to view detail page
3. Click "Kosarba" button
4. Verify: Toast notification appears, cart icon shows badge with count

**CART-02: User can select product variants when adding to cart**
1. Navigate to a product WITH variants
2. Verify: Variant selector buttons are visible
3. Try clicking "Kosarba" without selecting variant
4. Verify: Toast error "Kerem valasszon meretet"
5. Select a variant, then click "Kosarba"
6. Verify: Item added with correct variant name in cart

**CART-03: User can view cart contents**
1. Click cart icon in header
2. Verify: Cart sheet slides out from right
3. Verify: Shows all added items with name, variant, price, image

**CART-04: User can update quantities in cart**
1. Open cart sheet
2. Click + button on an item
3. Verify: Quantity increases, subtotal updates
4. Click - button
5. Verify: Quantity decreases, stops at 1

**CART-05: User can remove items from cart**
1. Open cart sheet
2. Click trash icon on an item
3. Verify: Item removed from cart
4. Verify: Subtotal updates correctly

**CART-06: Cart persists across browser sessions**
1. Add items to cart
2. Note the cart contents
3. Close browser completely
4. Reopen browser, navigate to site
5. Verify: Cart icon shows same count
6. Open cart sheet
7. Verify: Same items present with correct quantities
  </how-to-verify>
  <resume-signal>Type "cart-verified" if all CART requirements pass, or describe any issues found</resume-signal>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <name>Verify Coupon System (CART-07, ADMN-15 through ADMN-19)</name>
  <what-built>
Complete coupon system with:
- Strapi Coupon content type
- Fastify validation API
- CouponInput component
- Cart discount calculation
  </what-built>
  <how-to-verify>
**ADMN-15: Admin can create coupon codes**
1. Go to http://localhost:1337/admin
2. Navigate to Content Manager > Coupon
3. Click "Create new entry"
4. Enter: code "TESZT10", discountType "percentage", discountValue 10
5. Publish the coupon
6. Verify: Coupon saved and visible in list

**ADMN-16: Admin can set coupon as percentage or fixed discount**
1. Create another coupon: code "FIX1000", discountType "fixed", discountValue 1000
2. Publish
3. Verify: Both percentage and fixed types work

**ADMN-17: Admin can set coupon usage limits**
1. Edit TESZT10 coupon
2. Set usageLimit to 5
3. Save
4. Verify: Field saved correctly

**ADMN-18: Admin can set coupon expiration date**
1. Edit TESZT10 coupon
2. Set validFrom to today
3. Set validUntil to 30 days from now
4. Save
5. Verify: Dates saved correctly

**ADMN-19: Admin can enable/disable coupons**
1. Create coupon: code "DISABLED", discountType "percentage", discountValue 5
2. Set isActive to false
3. Publish
4. In frontend cart, try to apply "DISABLED"
5. Verify: Error message "A kupon nem aktiv"

**CART-07: User can apply coupon code to cart**
1. Open cart sheet with items
2. Find coupon input field
3. Enter "TESZT10" and click "Alkalmaz"
4. Verify: Success toast, coupon badge shows, discount appears in summary
5. Verify: Total reduced by 10%
6. Click X on coupon badge
7. Verify: Coupon removed, total restored
8. Try invalid code "INVALID123"
9. Verify: Error message "Ervenytelen kuponkod"
  </how-to-verify>
  <resume-signal>Type "coupon-verified" if all coupon requirements pass, or describe any issues found</resume-signal>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <name>Verify Animation and UX (ANIM-05)</name>
  <what-built>
Add-to-cart visual feedback with:
- Button state animation (idle -> loading -> success)
- Toast notifications
- Motion animations
  </what-built>
  <how-to-verify>
**ANIM-05: Add-to-cart has visual feedback animation**
1. Navigate to any product detail page
2. Click "Kosarba" button
3. Observe button animation:
   - Button text changes to loading spinner
   - After brief delay, shows checkmark with "Hozzaadva!"
   - Returns to "Kosarba" after ~1.5 seconds
4. Verify: Toast notification slides in from bottom-right
5. Verify: Toast shows product name

**Reduced motion preference:**
1. Enable reduced motion in OS settings
2. Repeat add-to-cart test
3. Verify: Animation still functional but respects preference (no jarring movement)
  </how-to-verify>
  <resume-signal>Type "animation-verified" if animation requirements pass, or describe any issues found</resume-signal>
</task>

</tasks>

<verification>
Phase 4 verification checklist:

| Requirement | Description | Status |
|-------------|-------------|--------|
| CART-01 | Add products to cart | [ ] |
| CART-02 | Select variants when adding | [ ] |
| CART-03 | View cart contents | [ ] |
| CART-04 | Update quantities | [ ] |
| CART-05 | Remove items | [ ] |
| CART-06 | Cart persistence | [ ] |
| CART-07 | Apply coupon code | [ ] |
| ADMN-15 | Create coupon codes | [ ] |
| ADMN-16 | Percentage/fixed discount | [ ] |
| ADMN-17 | Usage limits | [ ] |
| ADMN-18 | Expiration dates | [ ] |
| ADMN-19 | Enable/disable coupons | [ ] |
| ANIM-05 | Add-to-cart animation | [ ] |
</verification>

<success_criteria>
- All 7 CART requirements verified and working
- All 5 ADMN coupon requirements verified and working
- ANIM-05 add-to-cart animation provides clear visual feedback
- No console errors during cart operations
- Cart data persists correctly in localStorage
- TypeScript builds without errors
- Production build succeeds
</success_criteria>

<output>
After verification complete, create `.planning/phases/04-shopping-cart/04-08-SUMMARY.md` with:
- Verification results for each requirement
- Any issues found and resolutions
- Screenshots if helpful
- Phase 4 completion status
</output>
